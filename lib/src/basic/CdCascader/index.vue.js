"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue"),v=require("@/api/system"),k=t.defineComponent({name:"CdCascader"}),D=t.defineComponent({...k,props:{size:String,disabled:Boolean,filterable:Boolean,clearable:{type:Boolean,default:!0},modelValue:String,type:{type:String,default:""},pVal:String,pId:{type:String,default:"-1"},showableRootVals:{type:Array,default:()=>[]},showableSubVals:{type:Array,default:()=>[]},showableRootValsReverse:Boolean,showableSubValsReverse:Boolean,splitChar:{type:String,default:"/"},needEmptyItem:{type:Boolean,default:!1},emptyItemLabel:{type:String,default:"为空"},emptyItemValue:{type:String,default:"0"},selLastLev:{type:Boolean,default:!1},selMinLev:{type:Number,default:0},showLev:{type:Number,validator(c){return c?+c>1:!0},default:999}},emits:["update:modelValue","get-full-label","get-last-label","on-change"],setup(c,{expose:S,emit:i}){const e=c,m=()=>{L(),g()};let b=t.reactive([]),h=t.ref(!1);const g=()=>{h.value=!0,v.apiFindDictList({type:e.type,parentId:e.pId,parentValue:e.pVal}).then(l=>{const{isSuccess:a,errorMsg:n,data:o}=l||{};a?(b=o.map(r=>{if(r.lev=1,e.showableRootVals.length){const u=e.showableRootVals.includes(r.value),s=e.showableRootValsReverse?u:!u;r.disabled=s}else r.disabled=!1;return r.childrenSum>0?{...r,children:[],loading:!1}:r}),e.needEmptyItem&&b.splice(0,0,{label:e.emptyItemLabel,value:e.emptyItemValue})):window.$Message.error(n),h.value=!1})},f=t.ref();let d=t.ref([]);const L=async()=>{if(e.modelValue){d.value=[];let l=e.modelValue||"",a=0;const n=[];for(;a<=5;){const o=await v.apiFindDictItem({type:e.type,value:l}),{isSuccess:r,errorMsg:u,data:s}=o;r?s?(l=s.parentValue,n.push(s),a++,(s.parentValue===e.pVal||s.parentId===e.pId)&&(a=100)):a=100:(a=100,window.$Message.error(u))}n.reverse(),d.value=n.map(o=>o.value),setTimeout(()=>{f.value&&(f.value.selected=n)},200)}else d.value=[]};t.onBeforeMount(()=>{m()});const I=(l,a)=>{l.loading=!0,v.apiFindDictList({type:e.type,parentId:l.id}).then(n=>{const{isSuccess:o,errorMsg:r,data:u}=n||{};o?(l.children=u==null?void 0:u.map(s=>{if(s.lev=l.lev+1,s.lev===2)if(e.showableSubVals&&e.showableSubVals.length){console.log(e.showableSubVals,s,2333);const y=e.showableSubVals.includes(s.value),B=e.showableSubValsReverse?y:!y;s.disabled=B}else s.disabled=!1;return e.showLev!==999&&e.showLev<=s.lev?{...s,childrenSum:0}:s.childrenSum>0?{...s,children:[],loading:!1}:s}),l.loading=!1):window.$Message.error(r),a()})},M=(l,a)=>{d.value=l,i("update:modelValue",l[l.length-1]);const n=a.map(o=>o.label);i("get-full-label",n.join(e.splitChar)),i("get-last-label",n[n.length-1]),i("on-change",l,n)},w=t.ref(!1),C=["","一","二","三","四","五"],R=l=>{w.value=l,l||V()},V=()=>{const l=f.value.selected,a=l[l.length-1];return a&&!a.lev&&(a.lev=1),e.selLastLev&&!(l.length>0?a.childrenSum===0:!1)?(window.$Message.warning("请选择到最后一级"),p(),!1):e.selMinLev!==0&&e.selMinLev<=e.showLev&&(!a||a.lev<e.selMinLev)?(window.$Message.warning(`请至少选择到第${C[e.selMinLev]}级`),p(),!1):!0},p=()=>{d.value=[],i("update:modelValue","")};return S({levSelectJudgeHandle:V,resetValue:p}),t.watch(()=>e.modelValue,l=>{l||p()}),t.watch([()=>e.showableRootVals,()=>e.showableSubVals],()=>{g()}),t.watch([()=>e.pVal,()=>e.pId],()=>{g()}),(l,a)=>{const n=t.resolveComponent("Cascader");return t.unref(h)?(t.openBlock(),t.createBlock(n,{key:0})):(t.openBlock(),t.createBlock(n,{key:1,ref_key:"cascaderRef",ref:f,modelValue:t.unref(d),"onUpdate:modelValue":a[0]||(a[0]=o=>t.isRef(d)?d.value=o:d=o),transfer:"",data:t.unref(b),size:e.size,"load-data":I,"change-on-select":w.value,disabled:e.disabled,filterable:e.filterable,clearable:e.clearable,onOnChange:M,onOnVisibleChange:R},null,8,["modelValue","data","size","change-on-select","disabled","filterable","clearable"]))}}});exports.default=D;
