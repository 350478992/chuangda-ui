"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const k=require("vue");function T(l,o){const f=k.ref({}),I=()=>new Promise((e,n)=>{new BMap.Geocoder().getPoint(l.detailAddress,function(t){t?(f.value=t,e(t)):(window.$Modal.error({title:"提示",content:"您选择的地址没有解析到结果!",width:300}),n({}))},l.initCity)});let a=null;const P=e=>{a=new BMap.Marker(e),o.value.addOverlay(a),a.addEventListener("click",function(){$(e)}),l.isFirstShowWin&&$(e)},B=e=>"<div style='margin-bottom: 3px;border-bottom: 0.5px solid #5c6b77;'>路线导航</div><div><table style='line-height: 35px; font-size: 14px'><tr><td><div style='width:16px; height: 16px; background-color: #ed4014;border-radius: 50%;-moz-border-radius: 50%;-webkit-border-radius: 50%; padding-left: 16px'></div></td><td>目的地址</td><td><input style='width: 230px; height: 25px' value='"+e+"' readonly></td></tr><tr><td><div style='width:16px; height: 16px; background-color: #19be6b;border-radius: 50%;-moz-border-radius: 50%;-webkit-border-radius: 50%; padding-left: 16px'></div></td><td>当前位置</td><td><input id='suggestId' style='width: 230px; height: 25px' placeholder='请输入起点'><div id='searchResultPanel' style='border:5px solid #C0C0C0;width:150px;height:auto; display:none;'></div></td></tr></table></div><div style='text-align: center'><button id='walk' style='margin: 3px 10px; height: 22px;border: none;background-color: #2d8cf0;color: white;cursor: pointer;padding: 2px 5px;'>步行导航</button><button id='tran' style='margin: 3px 10px; height: 22px;border: none;background-color: #2d8cf0;color: white;cursor: pointer;padding: 2px 5px;'>公交导航</button><button id='drive' style='margin: 3px 10px; height: 23px;border: none;background-color: #2d8cf0;color: white;cursor: pointer;padding: 2px 5px;'>驾车导航</button></div></div>",$=e=>{const n=B(l.detailAddress),i=new BMap.InfoWindow(n);o.value.openInfoWindow(i,e);const t=new BMap.Autocomplete({input:"suggestId",location:o.value});t.addEventListener("onhighlight",function(r){const{value:s,index:d}=r.toitem,{value:w,index:u}=r.fromitem,{province:b,city:p,district:x,street:v,business:m}=w,{province:M,city:A,district:C,street:L,business:R}=s;let g=u>-1?`${b}${p}${x}${v}${m}`:"",y=`FromItem<br />index=${u}<br />value=${g}`;g=d>-1?`${M}${A}${C}${L}${R}`:g,y+=`<br />ToItem<br />index=${d}<br />value =${g}`;const S=document.getElementById("searchResultPanel");S.innerHTML=y}),t.addEventListener("onconfirm",function(r){const{value:s,index:d}=r.item,{province:w,city:u,district:b,street:p,business:x}=s,v=`${w}${u}${b}${p}${x}`;E(v);const m=document.getElementById("searchResultPanel");m.innerHTML=`onconfirm<br />index=${d}<br />myValue=${v}`}),setTimeout(()=>{const r=document.getElementById("walk"),s=document.getElementById("drive"),d=document.getElementById("tran");r&&r.addEventListener("click",()=>h("walk",e)),s&&s.addEventListener("click",()=>h("drive",e)),d&&d.addEventListener("click",()=>h("tran",e))},200)},c=k.ref({}),E=e=>{const n=new BMap.LocalSearch(o.value,{onSearchComplete:()=>{c.value=n.getResults().getPoi(0).point}});n.search(e)},h=(e,n)=>{if(!c.value.lat||!c.value.lng)window.$Modal.warning({title:"提示",content:"请先输入起点!",width:300});else{let i=null;const t={map:o.value,autoViewport:!0};e==="walk"?i=new BMap.WalkingRoute(o.value,{renderOptions:t}):e==="drive"?i=new BMap.DrivingRoute(o.value,{renderOptions:t}):e==="tran"&&(i=new BMap.TransitRoute(o.value,{renderOptions:t})),i.search(c.value,n),a.setAnimation(BMAP_ANIMATION_BOUNCE)}};return{pointInit:async()=>{if(!l.detailAddress)return window.$Message.warning("请先输入设备所在地地址");const e=await I();P(e)},usePoint:()=>f.value}}exports.default=T;
