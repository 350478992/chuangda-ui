"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue"),g=require("../useMapLoad.js"),w={class:"cd-map"},b=t.defineComponent({name:"GdMap"}),A=t.defineComponent({...b,props:{initCity:String,detailAddress:String,zoom:Number,mapHeight:String},setup(r,{expose:l}){const s=r,u=(Date.now()+Math.random()).toString(),c=`BMap-${parseInt(u)}`,{loadAMap:p}=g.default();let o=t.ref();const n=t.ref([]),m=async()=>{n.value=await f(),await p("64b450eb5cc56e7d6480c1fac7bd19e0").catch(e=>Promise.reject(`地图加载失败:${e}`)),o.value=new AMap.Map(c,{resizeEnable:!0,zoom:s.zoom,center:n.value}),o.value.plugin(["AMap.ToolBar"],function(){const e=new AMap.ToolBar;o.value.addControl(e)});const a=new AMap.Marker({position:n.value,title:s.detailAddress});o.value.add(a),AMap.event.addListener(a,"click",function(){const e=[s.detailAddress];new AMap.InfoWindow({content:e.join("<br/>")}).open(o.value,new AMap.LngLat(n.value[0],n.value[1]))})};t.onMounted(()=>{m()});const f=()=>new Promise(a=>{const e=new XMLHttpRequest,i=`http://restapi.amap.com/v3/geocode/geo?key=64b450eb5cc56e7d6480c1fac7bd19e0&address=${encodeURIComponent(s.detailAddress)}`;e.open("GET",i,!0),e.responseType="json",e.send(),e.onreadystatechange=function(){if(e.readyState==4&&e.status==200){const d=e.response;if(d.status==="1"){const{geocodes:M}=d,v=M[0].location.split(",");a(v)}else return Promise.reject("地址解析失败")}}});return l({usePoint:()=>n.value}),(a,e)=>(t.openBlock(),t.createElementBlock("div",w,[t.createElementVNode("div",{class:"cd-map-box",id:c,style:t.normalizeStyle(`height: ${r.mapHeight};`)},null,4)]))}});exports.default=A;
