"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),u=require("@/config"),x=require("@/api/system/layoutApi"),g=require("../CdFormField/index.js"),F=require("@/use/useLocalStorage"),E=require("@/util"),z={class:"form-box"},_={class:"group-box"},q={class:"font-700"},L={slot:"content"},O=e.defineComponent({name:"CdFormItemPanel"}),R=e.defineComponent({...O,props:{size:{type:String,default:u.defaultFormSize||"default"},noShowFieldControl:{type:Array,default:()=>[]},readOnly:{type:Boolean,default:!1},showRequired:{type:Boolean,default:!1},lazy:{type:Boolean,default:!1},name:{type:String,required:!0},viewNo:{type:String,required:!0},attrPrefix:{type:String,default:""},formObject:{type:Object,required:!0},ruleValidate:{type:Object,default:()=>({})},slots:{type:Array,default:()=>[]},fullItemKeys:{type:Array,default:()=>[]},defaultClosePanel:{type:Array,default:()=>[]}},emits:["renderPercentPath"],setup(l,{emit:T}){const d=l,a=e.reactive({formConfig:{id:"",no:"",name:"",type:"",formcol:1,dictColumns:[],groups:[],columns:[]},renderPercent:1,showRenderPercent:!1}),p=e.ref(u.showSubformPanelProp),w=e.computed(()=>24/a.formConfig.formcol),v=t=>{var r;return(r=d.defaultClosePanel)==null?void 0:r.includes(t)},k=async()=>{let{value:t,setValue:r,removeItem:c}=F.useLocalStorage(d.viewNo,"");if(!(u.viewConfigCache&&t)){const i=await x.getFormConfig(d.viewNo);E.handleResponse(i,()=>{t=i.data,t&&(a.formConfig=t,r(t),y(t.columns),B(t.groups))})}},y=(t=[])=>{t.length>0&&t.forEach(r=>V(r))},B=(t=[])=>{t.length>0&&t.forEach(r=>{y((r==null?void 0:r.columns)??[])}),a.formConfig.groups=t},V=t=>{const{compLength:r,dictType:c,dictParentId:i,dictParentValue:m}=t;t.viewId=a.formConfig.id,t.compLength=r?`${r}px`:"100%",t.dictConf={dictType:c||"",dictParentId:i||"",dictParentValue:m||""},t.colWidth=t.isLine==="1"?24:w.value},h=t=>{if(d.showRequired)return{required:t.isNull==="1",message:"请填写"+t.comments,trigger:"blur"}},b=t=>{var r;return t.colWidth===24?t.showType==="textarea"?"width:98%;":(r=d.fullItemKeys)!=null&&r.includes(t.name)?"width:100%;":`width:${1/a.formConfig.formcol*100}%;`:"width: 100%;"};return e.onMounted(()=>{d.viewNo&&a.formConfig.columns.length===0&&k()}),(t,r)=>{const c=e.resolveComponent("Progress"),i=e.resolveComponent("Form-item"),m=e.resolveComponent("Col"),C=e.resolveComponent("Row"),N=e.resolveComponent("Panel"),P=e.resolveComponent("Collapse");return e.openBlock(),e.createElementBlock("div",z,[e.withDirectives(e.createVNode(c,{percent:a.renderPercent,"hide-info":""},null,8,["percent"]),[[e.vShow,a.showRenderPercent]]),e.createElementVNode("div",null,[e.createVNode(C,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.formConfig.columns,o=>(e.openBlock(),e.createBlock(m,{span:o.colWidth,key:o.id},{default:e.withCtx(()=>[e.createVNode(i,{rules:h(o),style:e.normalizeStyle(o.colWidth==24&&o.showType=="textarea"?"width:98%;":""),label:o.comments,"label-width":200,prop:o.name},{default:e.withCtx(()=>[e.createElementVNode("span",{slot:"label",class:e.normalizeClass(o.styleName)},e.toDisplayString(o.comments),3),e.createTextVNode(" "+e.toDisplayString(p.value?`${o.name},${o.dbName}`:"")+" ",1),e.createVNode(e.unref(g.CdFormField),{modelValue:l.formObject[l.attrPrefix+o.name],"onUpdate:modelValue":s=>l.formObject[l.attrPrefix+o.name]=s,type:o.showType,size:l.size,name:o.name,prop:o.name,disabled:o.isReadonly==="1",readonly:o.isReadonly==="1"||l.readOnly,width:o.compLength,dictConf:o.dictConf},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.slots,(s,n)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[o.name==s?(e.openBlock(),e.createElementBlock("div",{key:n},[e.renderSlot(t.$slots,s)])):e.createCommentVNode("",!0)],64))),256))]),_:2},1032,["modelValue","onUpdate:modelValue","type","size","name","prop","disabled","readonly","width","dictConf"])]),_:2},1032,["rules","style","label","prop"])]),_:2},1032,["span"]))),128))]),_:3})]),e.createElementVNode("div",_,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.formConfig.groups,(o,s)=>(e.openBlock(),e.createElementBlock("div",{key:o.id},[e.createVNode(P,{class:"my-collapse",value:o.id},{default:e.withCtx(()=>[e.createVNode(N,{name:v(s)?"":o.id},{default:e.withCtx(()=>[e.createElementVNode("span",q,e.toDisplayString(o.name),1),e.createElementVNode("div",L,[e.createVNode(C,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.columns,n=>(e.openBlock(),e.createBlock(m,{span:n.colWidth,key:n.id},{default:e.withCtx(()=>[l.noShowFieldControl.indexOf(n.name)==-1?(e.openBlock(),e.createBlock(i,{key:0,rules:h(n),style:e.normalizeStyle(b(n)),label:n.comments,"label-width":200,prop:n.name},{default:e.withCtx(()=>[e.createElementVNode("span",{slot:"label",class:e.normalizeClass(n.styleName)},e.toDisplayString(n.comments),3),e.createTextVNode(" "+e.toDisplayString(p.value?n.name:"")+" ",1),e.createVNode(e.unref(g.CdFormField),{modelValue:l.formObject[n.name],"onUpdate:modelValue":f=>l.formObject[n.name]=f,type:n.showType,size:l.size,name:n.name,prop:n.name,readonly:n.isReadonly==="1"||l.readOnly,disabled:n.isReadonly==="1",width:n.compLength,dictConf:n.dictConf},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.slots,(f,S)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[n.name==f?(e.openBlock(),e.createElementBlock("div",{key:S},[e.renderSlot(t.$slots,f)])):e.createCommentVNode("",!0)],64))),256))]),_:2},1032,["modelValue","onUpdate:modelValue","type","size","name","prop","readonly","disabled","width","dictConf"])]),_:2},1032,["rules","style","label","prop"])):e.createCommentVNode("",!0)]),_:2},1032,["span"]))),128))]),_:2},1024)])]),_:2},1032,["name"])]),_:2},1032,["value"])]))),128))])])}}});exports.default=R;
