"use strict";var w=Object.create;var $=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var U=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty;var C=(a,i,u,g)=>{if(i&&typeof i=="object"||typeof i=="function")for(let l of I(i))!R.call(a,l)&&l!==u&&$(a,l,{get:()=>i[l],enumerable:!(g=q(i,l))||g.enumerable});return a};var M=(a,i,u)=>(u=a!=null?w(U(a)):{},C(i||!a||!a.__esModule?$(u,"default",{value:a,enumerable:!0}):u,a));Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const h=require("@/api/system"),b=require("@/util/bussTool");function k(){const a={qiye:"/a/stone/attachment/mobile-upload/qrcode-image",mis:"/api/equipment-documents/mobile-upload/qrcode-image"},i=(t,n="mis")=>{const{attitle:e,attClass:s,attCategory:o,attrefsysid:r,atttype:c}=t,d=e?encodeURI(e):"",m=s?encodeURI(s):"",y=o?encodeURI(o):"",p=r?encodeURI(r):"",f=c?encodeURI(c):"",S=b.getSidToken(),_=a[n];return`${window.$baseRequestUrl}${_}?attitle=${d}&attClass=${m}&attCategory=${y}&attrefsysid=${p}&atttype=${f}&__sid=${S}`},u=t=>new Promise((n,e)=>{try{import("ali-oss").then(s=>{const o=s.default;h.getAttachmentConfigs(t).then(r=>{const{accessKeyId:c,accessKeySecret:d,bucket:m,endpoint:y}=r.data,p=new o({accessKeyId:c,accessKeySecret:d,bucket:m,endpoint:y});n({ossInstance:p,config:r.data})})})}catch(s){e(s),window.$Message.warning(s)}}),g=()=>{const t=new Date,n=t.getFullYear(),e=t.getMonth()+1,s=t.getDate(),o=t.getHours(),r=t.getMinutes(),c=t.getSeconds();return""+n+e+s+o+r+c},l=t=>{let n=t.lastIndexOf("."),e="";return n!==-1&&(e=t.substring(n)),e};return{initOSS:u,uploadByOSS:(t,n,e)=>new Promise((s,o)=>{let r="";n.itemvalue&&(r+=`${n.itemvalue}/`),r+=`${g()}${Math.floor(Math.random()*1e4)}${l(e.file.name)}`;try{t.put(r,e.file).then(c=>{const d=c.url||`'http://${c.bucket}.${n.endpoint}/${c.name}`;Object.assign(e,{datasource:n.datasource,attfileroute:d,attname:e.file.name}),s(e)})}catch(c){o(c)}}),uploadRequest:(t,n)=>new Promise((e,s)=>{h.uploadAttachment(t,n).then(o=>{e(o)}).catch(o=>{s(o)})}),getQrcodeImgSrc:i}}exports.default=k;
