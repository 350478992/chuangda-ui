"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),g=require("@/api/system"),h=require("../../../basic/CdModal/index.vue.js"),x=require("../../CdPageList/PageListSimple/index.vue.js"),m=require("../../../basic/CdButton/index.vue.js"),D=require("../../../basic/CdInput/index.vue.js"),B=require("../../../basic/CdDatePickerRange/index.vue.js"),p=require("../../../basic/CdSelect/index.vue.js"),k=require("../AttachmentUpload/index.vue.js"),b=require("./useGetColumns.js"),S={style:{display:"flex"}},N=e.defineComponent({name:"CdAttachment"}),$=e.defineComponent({...N,props:{url:{default:"/api/eqm/attachment/listAttachmentInfo"},showCheckBox:{type:Boolean,default:!0},showSearchPanel:{type:Boolean,default:!0},idKey:{},cusColumns:{default:()=>[]},uploadShow:{type:Boolean,default:!0},delShow:{type:Boolean,default:!0},imgPreviewType:{default:"newTag"},modelValue:{type:Boolean},fileTitleShow:{type:Boolean,default:!0},attCategoryDisabled:{type:Boolean},attClassDisabled:{type:Boolean},attitleDisabled:{type:Boolean},attrefsysid:{},atttype:{},attCategory:{},attClass:{},attitle:{}},emits:["update:modelValue","on-del-success","on-upload-success"],setup(C,{emit:d}){const a=C,y=e.useAttrs(),c=e.computed({get:()=>a.modelValue,set:s=>{d("update:modelValue",s)}}),l=e.reactive({attrefsysid:a.attrefsysid||"",atttype:a.atttype||"",attCategory:a.attCategory||"",attClass:a.attClass||"",attitle:a.attitle||"",attnameLike:"",createDateBefore:"",createDateAfter:""}),_=()=>{l.attCategory="",l.attClass="",l.attitle=""},v=b.default(a),f=s=>{s===1&&(l.attClass=""),l.attitle=""},r=e.ref(),w=()=>{const{selectedRows:s}=r.value.tableOptions;if(!s.length)return window.$Message.warning("请选择数据");window.$Modal.confirm({title:"操作提示",content:`本次选择了${s.length}数据, 确认是否要删除`,loading:!0,onOk:()=>{const t=s.map(n=>n.attsysid);g.api_attachmentBatchDelete(t).then(n=>{n||(d("on-del-success",s),window.$Message.success("删除成功"),r.value.query()),window.$Modal.remove()})}})};e.provide("onUploadSuccessHandle",s=>{r.value.query(),d("on-upload-success",s)});const u=e.reactive({visible:!1});return(s,t)=>{const n=e.resolveComponent("Form-item"),i=e.resolveComponent("Col"),V=e.resolveComponent("Row");return e.openBlock(),e.createBlock(h.default,{modelValue:c.value,"onUpdate:modelValue":t[10]||(t[10]=o=>c.value=o),width:"1000",title:"附件管理","footer-hide":!0},{default:e.withCtx(()=>[e.createVNode(x.default,{ref_key:"pageListRef",ref:r,url:a.url,showCheckBox:a.showCheckBox,showSearch:a.showSearchPanel,isSearchOnActive:!1,searchForm:l,isLocalColumns:!0,localColumns:e.unref(v),onOnReset:_},{search:e.withCtx(()=>[e.createVNode(V,null,{default:e.withCtx(()=>[e.createVNode(i,{span:12},{default:e.withCtx(()=>[e.createVNode(n,{label:"附件标题"},{default:e.withCtx(()=>[e.createElementVNode("div",S,[e.createVNode(p.default,{class:"flex1",modelValue:l.attCategory,"onUpdate:modelValue":t[0]||(t[0]=o=>l.attCategory=o),type:"SCFJFL2.0","p-val":"SCFJFL2.0",onOnChange:t[1]||(t[1]=o=>f(1))},null,8,["modelValue"]),e.createVNode(p.default,{class:"flex1",modelValue:l.attClass,"onUpdate:modelValue":t[2]||(t[2]=o=>l.attClass=o),type:"SCFJFL2.0","p-val":l.attCategory,onOnChange:t[3]||(t[3]=o=>f(2))},null,8,["modelValue","p-val"]),e.createVNode(p.default,{class:"flex1",modelValue:l.attitle,"onUpdate:modelValue":t[4]||(t[4]=o=>l.attitle=o),type:"SCFJFL2.0","p-val":l.attClass},null,8,["modelValue","p-val"])])]),_:1})]),_:1}),e.createVNode(i,{span:12},{default:e.withCtx(()=>[e.createVNode(n,{label:"文件名",prop:"attnameLike"},{default:e.withCtx(()=>[e.createVNode(D.default,{modelValue:l.attnameLike,"onUpdate:modelValue":t[5]||(t[5]=o=>l.attnameLike=o),placeholder:"请输入文件名"},null,8,["modelValue"])]),_:1})]),_:1}),e.createVNode(i,{span:12},{default:e.withCtx(()=>[e.createVNode(n,{label:"上传时间"},{default:e.withCtx(()=>[e.createVNode(B.default,{keys:["createDateBefore","createDateAfter"],startDate:l.createDateBefore,"onUpdate:startDate":t[6]||(t[6]=o=>l.createDateBefore=o),endDate:l.createDateAfter,"onUpdate:endDate":t[7]||(t[7]=o=>l.createDateAfter=o)},null,8,["startDate","endDate"])]),_:1})]),_:1})]),_:1})]),function:e.withCtx(()=>[a.uploadShow?(e.openBlock(),e.createBlock(m.default,{key:0,type:"text",icon:"upload","icon-render":"svg",onClick:t[8]||(t[8]=o=>u.visible=!0)},{default:e.withCtx(()=>[e.createTextVNode(" 上传 ")]),_:1})):e.createCommentVNode("",!0),a.delShow?(e.openBlock(),e.createBlock(m.default,{key:1,type:"text",icon:"del","icon-render":"svg",onClick:w},{default:e.withCtx(()=>[e.createTextVNode(" 删除 ")]),_:1})):e.createCommentVNode("",!0)]),_:1},8,["url","showCheckBox","showSearch","searchForm","localColumns"]),u.visible?(e.openBlock(),e.createBlock(k.default,e.mergeProps({key:0,modelValue:u.visible,"onUpdate:modelValue":t[9]||(t[9]=o=>u.visible=o),fileTitleShow:a.fileTitleShow,attrefsysid:a.attrefsysid,atttype:a.atttype,attCategory:a.attCategory,attClass:a.attClass,attitle:a.attitle,attCategoryDisabled:a.attCategoryDisabled,attClassDisabled:a.attClassDisabled,attitleDisabled:a.attitleDisabled},e.unref(y)),null,16,["modelValue","fileTitleShow","attrefsysid","atttype","attCategory","attClass","attitle","attCategoryDisabled","attClassDisabled","attitleDisabled"])):e.createCommentVNode("",!0)]),_:1},8,["modelValue"])}}});exports.default=$;
