"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue");require("./style/index.css");const b=require("@/config"),U=require("@/util/baseTool"),j=require("../UserViewConfig/index.vue.js"),i=require("../../../basic/CdButton/index.js"),G=require("./useProps.js"),W=require("../common/useTableSort.js"),J=require("../common/useFetchParams.js"),X=require("../common/useGetColumns.js"),Y=require("../common/useLoadData.js"),Z=require("../common/useAutoTableHeight.js"),ee={class:"cd-pagelist"},te={class:"text-btn-box"},oe={class:"text-success"},ae={class:"text-success"},ne=e.defineComponent({name:"CdPageList"}),re=e.defineComponent({...ne,props:G.default(),emits:["on-reset","on-afater-load","on-select-change","on-row-dblclick","on-page-change","on-query-able","on-search-before","on-search-after"],setup(S,{expose:x,emit:s}){const t=S,f=e.ref(!1),d=e.ref(!1),a=e.reactive({tableData:e.ref([]),count:e.ref(0),pageNum:e.ref(1),currentPageSize:e.ref(t.pageSize),noDataText:e.ref("请设置查询条件后再进行查询"),tableHeight:e.ref(t.fixedHeight),loading:e.ref(!1),selectedId:e.ref([]),selectedRows:e.ref([]),equNum:e.ref(0),canQuery:!0}),v=J.default(t,a),u=Y.default(t,a,v,s),N=()=>{a.canQuery=!0,a.pageNum=1,a.count=0,s("on-query-able"),a.canQuery&&(s("on-search-before"),a.selectedId=[],a.selectedRows=[],u(),s("on-search-after"))},B=e.computed(()=>b.openEnterSearch||t.openEnterSearch),q=()=>{B&&N()},y=e.ref(),H=()=>{y.value.resetFields(),s("on-reset")};e.ref();const P=()=>{console.log("高级查询条件获取方法调用")};let V=e.ref([]);const m=e.reactive({visible:!1,reason:"",style:""}),{getColumnsHandle:w}=X.default(t,V,m);e.onBeforeMount(()=>{w()}),e.watch(()=>t.tableViewNo,()=>{w(),t.autoSearchByViewChange&&u()}),e.watch(()=>t.localColumns,()=>{w()});const{webSortHandle:z,remoteSortHandle:D}=W.default(b,t),R=o=>{t.webOrderBy?z(o,a):(D(o,v),u())},_=e.ref(),{autoHeightHandle:T}=Z.default(t,_,a);e.onBeforeMount(()=>{T()});const O=o=>{a.selectedRows=o,a.selectedId=o.map(n=>n[t.idName]),s("on-select-change",a.selectedRows,a.selectedId)},E=(o,n,c,C)=>{if(U.isNotEmpty(c)&&b.isCellClick){const r=document.createElement("input");document.body.appendChild(r),r.setAttribute("value",c),r.select(),document.execCommand("copy")&&window.$Message.success("复制成功"),document.body.removeChild(r)}},F=(o,n)=>{s("on-row-dblclick",o,n)},I=e.computed(()=>a.selectedRows.length),Q=o=>{a.currentPageSize=o,u()},K=o=>{a.pageNum=o,u(),s("on-page-change")},l=e.reactive({visible:!1,title:"查询条件自定义字段",width:"500",viewNo:"",viewId:"",type:""}),g=o=>{l.visible=!0,l.type=o,l.title=o==="0"?"查询条件自定义字段":"表格自定义展示字段",l.viewNo=o==="0"?t.queryViewNo:t.tableViewNo,l.viewId=""},M=o=>{o==="0"?P():w()};return x({tableOptions:a,onViewConfigShowHandle:g}),(o,n)=>{const c=e.resolveComponent("Input"),C=e.resolveComponent("Form-item"),r=e.resolveComponent("Col"),p=e.resolveComponent("Row"),$=e.resolveComponent("Form"),k=e.resolveComponent("Card"),A=e.resolveComponent("Table"),L=e.resolveComponent("Page");return e.openBlock(),e.createElementBlock("div",ee,[t.showSearch?(e.openBlock(),e.createBlock(k,{key:0,class:"search-wrap mb10",ref_key:"searchCardRef",ref:_,"dis-hover":""},{default:e.withCtx(()=>[e.createVNode($,{class:"search-wrap-form",ref_key:"tableSearchFormRef",ref:y,model:t.searchForm,inline:t.inline,"label-width":t.labelWidth,onKeydown:e.withKeys(q,["native","enter"])},{default:e.withCtx(()=>[e.renderSlot(o.$slots,"search"),e.withDirectives(e.createElementVNode("div",null,[e.renderSlot(o.$slots,"fold")],512),[[e.vShow,d.value]]),f.value?(e.openBlock(),e.createBlock(p,{key:0},{default:e.withCtx(()=>[e.createVNode(r,{span:"8"},{default:e.withCtx(()=>[e.createVNode(C,{label:"设备识别码"},{default:e.withCtx(()=>[e.createVNode(c)]),_:1})]),_:1}),e.createVNode(r,{span:"8"},{default:e.withCtx(()=>[e.createVNode(C,{label:"设备识别码"},{default:e.withCtx(()=>[e.createVNode(c)]),_:1})]),_:1}),e.createVNode(r,{span:"8"},{default:e.withCtx(()=>[e.createVNode(C,{label:"设备识别码"},{default:e.withCtx(()=>[e.createVNode(c)]),_:1})]),_:1})]),_:1})):e.createCommentVNode("",!0)]),_:3},8,["model","inline","label-width","onKeydown"]),e.createVNode(p,{class:"search-wrap-btns"},{default:e.withCtx(()=>[e.createVNode(r,{class:"tc",span:"24"},{default:e.withCtx(()=>[e.createVNode(e.unref(i.CdButton),{type:"primary",icon:"ios-search",loading:a.loading,onClick:N},{default:e.withCtx(()=>[e.createTextVNode(" 查询 ")]),_:1},8,["loading"]),t.showResetBtn?(e.openBlock(),e.createBlock(e.unref(i.CdButton),{key:0,class:"ml10",icon:"md-refresh",onClick:H},{default:e.withCtx(()=>[e.createTextVNode(" 重置 ")]),_:1})):e.createCommentVNode("",!0),e.renderSlot(o.$slots,"otherBtn"),e.createElementVNode("div",te,[t.showFold?(e.openBlock(),e.createBlock(e.unref(i.CdButton),{key:0,class:"text-info",type:"text",icon:d.value?"ios-arrow-up":"ios-arrow-down","icon-color":"primary",onClick:n[0]||(n[0]=h=>d.value=!d.value)},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(d.value?"隐藏":"展开"),1)]),_:1},8,["icon"])):e.createCommentVNode("",!0),o.showOtherQueryPanel?(e.openBlock(),e.createBlock(e.unref(i.CdButton),{key:1,class:"text-info",type:"text",icon:"md-flower","icon-color":"primary",onClick:n[1]||(n[1]=h=>g("0"))},{default:e.withCtx(()=>[e.createTextVNode(" 设置 ")]),_:1})):e.createCommentVNode("",!0),o.showOtherQueryPanel?(e.openBlock(),e.createBlock(e.unref(i.CdButton),{key:2,class:"text-info",type:"text",icon:"ios-search-outline","icon-color":"primary",onClick:n[2]||(n[2]=h=>f.value=!f.value)},{default:e.withCtx(()=>[e.createElementVNode("span",null,e.toDisplayString(f.value?"普通查询":"高级查询"),1)]),_:1})):e.createCommentVNode("",!0)])]),_:3})]),_:3})]),_:3},512)):e.createCommentVNode("",!0),e.createVNode(k,{"dis-hover":""},{default:e.withCtx(()=>[e.createVNode(p,{class:"table-btnbar"},{default:e.withCtx(()=>[e.createVNode(r,{class:"table-btnbar-left",span:"18"},{default:e.withCtx(()=>[e.renderSlot(o.$slots,"function")]),_:3}),e.createVNode(r,{class:"table-btnbar-right",span:"6"},{default:e.withCtx(()=>[t.columnsSettingShow?(e.openBlock(),e.createBlock(e.unref(i.CdButton),{key:0,type:"text",icon:"md-flower",onClick:n[3]||(n[3]=h=>g("1"))},{default:e.withCtx(()=>[e.createTextVNode(" 设置 ")]),_:1})):e.createCommentVNode("",!0)]),_:1}),e.renderSlot(o.$slots,"function-extra")]),_:3}),e.createVNode(p,{class:"table-box"},{default:e.withCtx(()=>[e.createVNode(r,{span:"24"},{default:e.withCtx(()=>[e.createVNode(A,{ref:"tableRef",columns:e.unref(V),border:t.border,stripe:t.stripe,"show-header":t.showHeader,size:t.size,"row-key":t.rowKey,"row-class-name":t.rowClassName,"highlight-row":t.highlightRow,"load-data":t.handleLoadData,loading:a.loading,height:a.tableHeight,data:a.tableData,"no-data-text":a.noDataText,onOnSortChange:R,onOnSelectionChange:O,onOnCellClick:E,onOnRowDblclick:F},null,8,["columns","border","stripe","show-header","size","row-key","row-class-name","highlight-row","load-data","loading","height","data","no-data-text"])]),_:1})]),_:1}),o.pageShow?(e.openBlock(),e.createBlock(p,{key:0,class:"table-pager"},{default:e.withCtx(()=>[e.createVNode(r,{span:o.pageBarSpan},{default:e.withCtx(()=>[e.createVNode(L,{size:"small","show-elevator":"","show-sizer":"",transfer:"",current:a.pageNum,"page-size-opts":t.pageSizes,"page-size":a.currentPageSize,total:a.count,placement:t.pagePlacement,onOnPageSizeChange:Q,onOnChange:K},null,8,["current","page-size-opts","page-size","total","placement"])]),_:1},8,["span"]),e.createVNode(r,{span:24-o.pageBarSpan,class:"table-total-tip"},{default:e.withCtx(()=>[e.renderSlot(o.$slots,"equNum",{equNum:a.equNum}),e.createTextVNode(" 当前共有 "),e.createElementVNode("span",oe,e.toDisplayString(a.count),1),e.createTextVNode(" 条数据 ，已选 "),e.createElementVNode("span",ae,e.toDisplayString(I.value),1),e.createTextVNode(" 条 ")]),_:3},8,["span"])]),_:3})):e.createCommentVNode("",!0)]),_:3}),l.visible?(e.openBlock(),e.createBlock(e.unref(j.default),{key:1,modelValue:l.visible,"onUpdate:modelValue":n[4]||(n[4]=h=>l.visible=h),type:l.type,title:l.title,width:l.width,"view-no":l.viewNo,"view-id":l.viewId,onAfterSave:M},null,8,["modelValue","type","title","width","view-no","view-id"])):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("div",{class:"back-tip",style:e.normalizeStyle(m.style)},e.toDisplayString(m.reason),5),[[e.vShow,m.visible]])])}}});exports.default=re;
