"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue");require("./style/index.css");const p=require("@/config"),M=require("@/util/baseTool"),f=require("../../../basic/CdButton/index.js"),A=require("../UserViewConfig/index.vue.js"),Q=require("./useProps.js"),L=require("../common/useTableSort.js"),U=require("../common/useFetchParams.js"),j=require("../common/useGetColumns.js"),G=require("../common/useLoadData.js"),W=require("../common/useAutoTableHeight.js"),J={class:"cd-pagelist-simple"},X={class:"text-success"},Y={class:"text-success"},Z=e.defineComponent({name:"CdPageListSimple"}),$=e.defineComponent({...Z,props:Q.default(),emits:["on-reset","on-afater-load","on-select-change","on-row-dblclick","on-page-change","on-query-able","on-search-before","on-search-after"],setup(N,{expose:v,emit:l}){const t=N,o=e.reactive({tableData:e.ref([]),count:e.ref(0),pageNum:e.ref(1),currentPageSize:e.ref(t.pageSize),noDataText:e.ref("请设置查询条件后再进行查询"),tableHeight:e.ref(t.fixedHeight),loading:e.ref(!1),selectedId:e.ref([]),selectedRows:e.ref([]),equNum:e.ref(0),canQuery:!0}),w=U.default(t,o),i=G.default(t,o,w,l),h=()=>{o.canQuery=!0,o.pageNum=1,o.count=0,l("on-query-able"),o.canQuery&&(l("on-search-before"),o.selectedId=[],o.selectedRows=[],i(),l("on-search-after"))},_=e.computed(()=>p.openEnterSearch||t.openEnterSearch),y=()=>{_&&h()},m=e.ref(),S=()=>{m.value.resetFields(),l("on-reset")};let g=e.ref([]);const V=e.reactive({visible:!1,reason:"",style:""}),{getColumnsHandle:d}=j.default(t,g,V);e.onBeforeMount(()=>{d()}),e.watch(()=>t.tableViewNo,()=>{d(),t.autoSearchByViewChange&&i()}),e.watch(()=>t.localColumns,()=>{d()});const{webSortHandle:k,remoteSortHandle:x}=L.default(p,t),B=a=>{t.webOrderBy?k(a,o):(x(a,w),i())},C=e.ref(),{autoHeightHandle:q}=W.default(t,C,o);e.onBeforeMount(()=>{q()});const H=a=>{o.selectedRows=a,o.selectedId=a.map(s=>s[t.idName]),l("on-select-change",o.selectedRows,o.selectedId)},R=(a,s,u,c)=>{if(M.isNotEmpty(u)&&p.isCellClick){const r=document.createElement("input");document.body.appendChild(r),r.setAttribute("value",u),r.select(),document.execCommand("copy")&&window.$Message.success("复制成功"),document.body.removeChild(r)}},z=(a,s)=>{l("on-row-dblclick",a,s)},P=e.computed(()=>o.selectedRows.length),T=a=>{o.currentPageSize=a,i()},D=a=>{o.pageNum=a,i(),l("on-page-change")},n=e.reactive({visible:!1,title:"查询条件自定义字段",width:"500",viewNo:"",viewId:"",type:""}),O=a=>{n.visible=!0,n.type=a,n.title=a==="0"?"查询条件自定义字段":"表格自定义展示字段",n.viewNo=a==="0"?t.queryViewNo:t.tableViewNo,n.viewId=""},E=a=>{a==="0"||d()};return v({tableOptions:o,onViewConfigShowHandle:O,query:h}),(a,s)=>{const u=e.resolveComponent("Form"),c=e.resolveComponent("Col"),r=e.resolveComponent("Row"),b=e.resolveComponent("Card"),F=e.resolveComponent("Table"),I=e.resolveComponent("Page");return e.openBlock(),e.createElementBlock("div",J,[t.showSearch?(e.openBlock(),e.createBlock(b,{key:0,class:"search-wrap",ref_key:"searchCardRef",ref:C,"dis-hover":""},{default:e.withCtx(()=>[e.createVNode(u,{class:"search-wrap-form",ref_key:"tableSearchFormRef",ref:m,model:t.searchForm,inline:t.inline,"label-width":t.labelWidth,onKeydown:e.withKeys(y,["native","enter"])},{default:e.withCtx(()=>[e.renderSlot(a.$slots,"search")]),_:3},8,["model","inline","label-width","onKeydown"]),e.createVNode(r,{class:"search-wrap-btns"},{default:e.withCtx(()=>[e.createVNode(c,{class:"tc",span:"24"},{default:e.withCtx(()=>[e.createVNode(e.unref(f.CdButton),{type:"primary",icon:"ios-search",loading:o.loading,onClick:h},{default:e.withCtx(()=>[e.createTextVNode(" 查询 ")]),_:1},8,["loading"]),t.showResetBtn?(e.openBlock(),e.createBlock(e.unref(f.CdButton),{key:0,icon:"md-refresh",onClick:S},{default:e.withCtx(()=>[e.createTextVNode(" 重置 ")]),_:1})):e.createCommentVNode("",!0),e.renderSlot(a.$slots,"otherBtn")]),_:3})]),_:3})]),_:3},512)):e.createCommentVNode("",!0),e.createVNode(b,{"dis-hover":""},{default:e.withCtx(()=>[e.createVNode(r,{class:"table-btnbar"},{default:e.withCtx(()=>[e.createVNode(c,{class:"table-btnbar-left",span:"18"},{default:e.withCtx(()=>[e.renderSlot(a.$slots,"function")]),_:3}),e.createVNode(c,{class:"table-btnbar-right",span:"6"},{default:e.withCtx(()=>[t.columnsSettingShow?(e.openBlock(),e.createBlock(e.unref(f.CdButton),{key:0,type:"text",icon:"md-flower"},{default:e.withCtx(()=>[e.createTextVNode(" 设置 ")]),_:1})):e.createCommentVNode("",!0)]),_:1}),e.renderSlot(a.$slots,"function-extra")]),_:3}),e.createVNode(r,{class:"table-box"},{default:e.withCtx(()=>[e.createVNode(c,{span:"24"},{default:e.withCtx(()=>[e.createVNode(F,{ref:"tableRef",columns:e.unref(g),border:t.border,stripe:t.stripe,"show-header":t.showHeader,size:t.size,"row-key":t.rowKey,"row-class-name":t.rowClassName,"highlight-row":t.highlightRow,"load-data":t.handleLoadData,loading:o.loading,height:o.tableHeight,data:o.tableData,"no-data-text":o.noDataText,onOnSortChange:B,onOnSelectionChange:H,onOnCellClick:R,onOnRowDblclick:z},null,8,["columns","border","stripe","show-header","size","row-key","row-class-name","highlight-row","load-data","loading","height","data","no-data-text"])]),_:1})]),_:1}),a.pageShow?(e.openBlock(),e.createBlock(r,{key:0,class:"table-pager"},{default:e.withCtx(()=>[e.createVNode(c,{span:a.pageBarSpan},{default:e.withCtx(()=>[e.createVNode(I,{size:"small","show-elevator":"","show-sizer":"",transfer:"",current:o.pageNum,"page-size-opts":t.pageSizes,"page-size":o.currentPageSize,total:o.count,placement:t.pagePlacement,onOnPageSizeChange:T,onOnChange:D},null,8,["current","page-size-opts","page-size","total","placement"])]),_:1},8,["span"]),e.createVNode(c,{span:24-a.pageBarSpan,class:"table-total-tip"},{default:e.withCtx(()=>[e.renderSlot(a.$slots,"equNum",{equNum:o.equNum}),e.createTextVNode(" 当前共有 "),e.createElementVNode("span",X,e.toDisplayString(o.count),1),e.createTextVNode(" 条数据 ，已选 "),e.createElementVNode("span",Y,e.toDisplayString(P.value),1),e.createTextVNode(" 条 ")]),_:3},8,["span"])]),_:3})):e.createCommentVNode("",!0)]),_:3}),n.visible?(e.openBlock(),e.createBlock(e.unref(A.default),{key:1,modelValue:n.visible,"onUpdate:modelValue":s[0]||(s[0]=K=>n.visible=K),type:n.type,title:n.title,width:n.width,"view-no":n.viewNo,"view-id":n.viewId,onAfterSave:E},null,8,["modelValue","type","title","width","view-no","view-id"])):e.createCommentVNode("",!0)])}}});exports.default=$;
