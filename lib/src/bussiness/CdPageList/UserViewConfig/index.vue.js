"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue");require("./style/index.css");const p=require("@/api/system"),N=require("../../../basic/CdModal/index.vue.js"),k=require("@/util/baseTool"),_=require("view-ui-plus"),B={class:"header-extra"},S=e.createElementVNode("span",{class:"text-info"},"帮助提示",-1),E=e.createElementVNode("div",null,"1.勾选展示字段，可设置字段是否在页面上展示",-1),x=e.createElementVNode("div",null,"2.上下拖动字段名称，可调整字段在页面上的显示位置",-1),H=e.createElementVNode("div",null," 3.勾选冻结字段，左右拖动视图时，该字段及该字段之前字段将始终显示在页面上 ",-1),M=e.defineComponent({name:"UserViewConfig"}),T=e.defineComponent({...M,props:{modelValue:{type:Boolean,default:!1},id:{type:String,default:""},title:{type:String,default:""},draggable:{type:Boolean,default:!0},tableHeight:{type:String,default:"350"},type:{type:String,default:"0"},viewNo:{type:String,required:!0}},emits:["update:modelValue","after-save"],setup(v,{emit:u}){const r=v,f=e.computed({get:()=>r.modelValue,set:()=>u("update:modelValue")}),h=e.computed(()=>r.title),a=e.reactive({tableData:[],tableDataHidden:[],columns:[],selectedRows:[],loading:!1}),b=()=>{a.columns=[{type:"selection",width:50,align:"center"},{title:"字段名称",key:"comments"}],r.type==="1"&&a.columns.push({title:"字段文字颜色",width:120,key:"labelColor",align:"center",render:(o,{row:t,index:l})=>(t.labelColor||(t.labelColor="#000000"),o("div",[o(_.ColorPicker,{modelValue:t.labelColor,colors:["#2D8CF0","#19BE6B","#FF9900","#ED4014","#00B5FF","#19C919","#F9E31C","#EA1A1A","#9B1DEA","#00C2B1","#AC7A33","#1D35EA","#8BC34A","#F16B62","#EA4CA3","#0D94AA","#FEBD79","#5D4037","#00BCD4","#F06292","#CDDC39","#607D8B","#000000","#FFFFFF"],transfer:!0,"onOn-change":n=>{e.nextTick(()=>{a.tableData[l]._checked=t._checked,a.tableData[l].labelColor=n})}},"")]))},{title:"冻结字段",width:100,key:"isFreeze",align:"center",render:(o,{row:t,index:l})=>o(_.Checkbox,{modelValue:t.isFreeze,checked:t.isFreeze==="1","true-value":"1","false-value":"0","onOn-change":n=>{a.tableData[l]._checked=t._checked,a.tableData[l].isFreeze=n}},"")})};let g="";const w=()=>{if(!k.isNotEmpty(r.viewNo))return window.$Message.warning("视图编号不存在");a.loading=!0,(r.type==="0"?p.api_getSearchFormConfig:p.api_getTableConfig)(r.viewNo).then(t=>{const{isSuccess:l,errorMsg:n,errmsg:s,data:c}=t;if(l){if(a.tableData=[],a.tableDataHidden=[],g=c.id,c.columns){let m=c.columns.map(d=>({...d,_checked:d.isChecked}));for(const d of m)d.showType!=="hidden"?a.tableData.push(d):a.tableDataHidden.push(d)}}else window.$Message.error(n||s);a.loading=!1})},D=o=>{a.selectedRows=o},y=(o,t)=>{a.tableData.splice(t,0,a.tableData.splice(t+(o-t),1)[0])},i=e.ref(!1),F=()=>{const o={viewId:g};let t=[];if(a.selectedRows.length>0){t=[...a.selectedRows,...a.tableDataHidden];for(let l=0;l<t.length;l++){const n=t[l],s=`columnList[${l}]`;o[`${s}.id`]="",o[`${s}.viewCol.column.id`]=n.id,o[`${s}.viewCol.column.name`]=n.name,o[`${s}.labelColor`]=n.labelColor,o[`${s}.isFreeze`]=n.isFreeze,o[`${s}.sort`]=l}i.value=!0,p.api_userFormConfigSave(o).then(l=>{const{isSuccess:n,errorMsg:s,errmsg:c}=l;n?(window.$Message.success("保存成功"),C(),u("after-save",r.type)):window.$Message.errorMsg(s||c),i.value=!1},()=>{i.value=!1})}},V=()=>{i.value=!0,p.api_userFormConfigDelete(g).then(o=>{const{isSuccess:t,errorMsg:l,errmsg:n}=o;t?(C(),u("after-save",r.type)):window.$Message.error(l||n),i.value=!1},()=>{i.value=!1})},C=()=>u("update:modelValue",!1);return e.onBeforeMount(()=>{b(),w()}),(o,t)=>{const l=e.resolveComponent("Icon"),n=e.resolveComponent("Poptip"),s=e.resolveComponent("Table"),c=e.resolveComponent("Button");return e.openBlock(),e.createBlock(N.default,{class:"cd-user-view-config",modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=m=>f.value=m),title:h.value,width:"300"},{header:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(h.value)+" ",1),e.createElementVNode("div",B,[e.createVNode(n,{trigger:"hover",title:"提示",placement:"top-start",transfer:""},{content:e.withCtx(()=>[E,x,H]),default:e.withCtx(()=>[e.createVNode(l,{type:"md-help-circle",size:"18",class:"text-info"}),S]),_:1})])]),footer:e.withCtx(()=>[e.createVNode(c,{type:"primary",loading:i.value,onClick:V},{default:e.withCtx(()=>[e.createTextVNode("还原初始配置")]),_:1},8,["loading"]),e.createVNode(c,{class:"ml10",type:"primary",loading:i.value,onClick:F},{default:e.withCtx(()=>[e.createTextVNode("保 存")]),_:1},8,["loading"])]),default:e.withCtx(()=>[e.createVNode(s,{ref:"userConfigTableRef",size:"small",height:r.tableHeight,draggable:r.draggable,loading:a.loading,columns:a.columns,data:a.tableData,border:!0,"show-header":!0,onOnSelectionChange:D,onOnDragDrop:y},null,8,["height","draggable","loading","columns","data"])]),_:1},8,["modelValue","title"])}}});exports.default=T;
